@model RecordStore.Domain.DTO.DashboardViewModel
@{
    ViewData["Title"] = "Admin Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .dashboard-card-link {
        cursor: pointer;
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }

    .dashboard-card-link:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 1rem rgba(0,0,0,.15);
    }

    .interactive-btn {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }

    .interactive-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 0.4rem 0.8rem rgba(0,0,0,.15);
    }

    .disabled-card {
        cursor: not-allowed;
        opacity: 0.8;
    }

    .modal-scrollable-content {
        max-height: 65vh;
        overflow-y: auto;
    }

    .rating-stars-modal {
        color: #ffc107;
    }
</style>

<div class="container my-5">
    <h1 class="mb-4">Admin Dashboard</h1>

    <div class="row">
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card text-white bg-primary h-100 @(Model.TotalUsers > 0 ? "dashboard-card-link" : "disabled-card")"
                 @(Model.TotalUsers > 0 ? Html.Raw("data-bs-toggle=\"modal\" data-bs-target=\"#usersModal\"") : null)>
                <div class="card-body"><div class="d-flex justify-content-between align-items-center"><div><h2 class="card-title fw-bold">@Model.TotalUsers</h2><p class="card-text">Total Users</p></div><i class="fas fa-users fa-3x opacity-50"></i></div></div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card text-white bg-info h-100 @(Model.TotalOrders > 0 ? "dashboard-card-link" : "disabled-card")"
                 @(Model.TotalOrders > 0 ? Html.Raw("data-bs-toggle=\"modal\" data-bs-target=\"#ordersModal\"") : null)>
                <div class="card-body"><div class="d-flex justify-content-between align-items-center"><div><h2 class="card-title fw-bold">@Model.TotalOrders</h2><p class="card-text">Total Orders</p></div><i class="fas fa-shopping-cart fa-3x opacity-50"></i></div></div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card text-white bg-success h-100 @(Model.TotalRecords > 0 ? "dashboard-card-link" : "disabled-card")"
                 @(Model.TotalRecords > 0 ? Html.Raw("data-bs-toggle=\"modal\" data-bs-target=\"#recordsModal\"") : null)>
                <div class="card-body"><div class="d-flex justify-content-between align-items-center"><div><h2 class="card-title fw-bold">@Model.TotalRecords</h2><p class="card-text">Records in Store</p></div><i class="fas fa-compact-disc fa-3x opacity-50"></i></div></div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <div class="card text-white bg-warning h-100 @(Model.TotalReviews > 0 ? "dashboard-card-link" : "disabled-card")"
                 @(Model.TotalReviews > 0 ? Html.Raw("data-bs-toggle=\"modal\" data-bs-target=\"#reviewsModal\"") : null)>
                <div class="card-body"><div class="d-flex justify-content-between align-items-center"><div><h2 class="card-title fw-bold">@Model.TotalReviews</h2><p class="card-text">Total Reviews</p></div><i class="fas fa-comments fa-3x opacity-50"></i></div></div>
            </div>
        </div>
    </div>

    <hr class="my-4">

    <h3 class="mb-4">Content Management</h3>
    <div class="row">
        <div class="col-lg-3 col-md-6 mb-4">
            <a asp-controller="Admin" asp-action="Analytics" class="text-decoration-none">
                <div class="card h-100 text-center dashboard-card-link">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center">
                        <i class="fa-solid fa-chart-pie fa-3x mb-3 text-success"></i>
                        <h5 class="card-title">Analytics</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <a asp-controller="Admin" asp-action="ManageInventory" class="text-decoration-none">
                <div class="card h-100 text-center dashboard-card-link">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center">
                        <i class="fa-solid fa-boxes-stacked fa-3x mb-3 text-primary"></i>
                        <h5 class="card-title">Manage Inventory</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <a asp-controller="RecordLabels" asp-action="Index" class="text-decoration-none">
                <div class="card h-100 text-center dashboard-card-link">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center">
                        <i class="fa-solid fa-building-columns fa-3x mb-3 text-info"></i>
                        <h5 class="card-title">Manage Record Labels</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <a asp-controller="Admin" asp-action="ManageReviews" class="text-decoration-none">
                <div class="card h-100 text-center dashboard-card-link">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center">
                        <i class="fa-solid fa-comments fa-3x mb-3 text-warning"></i>
                        <h5 class="card-title">Manage Reviews</h5>
                    </div>
                </div>
            </a>
        </div>
    </div>
    <hr class="my-4">
    <h3 class="mb-4 mt-3">Data & Import/Export</h3>
    <div class="row">
        <div class="col-lg-3 col-md-6 mb-4">
            <a asp-controller="Admin" asp-action="ExportUsers" class="text-decoration-none">
                <div class="card h-100 text-center dashboard-card-link">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center">
                        <i class="fa-solid fa-file-export fa-3x mb-3 text-secondary"></i>
                        <h5 class="card-title">Export Users</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <a asp-controller="Admin" asp-action="ExportAllOrders" class="text-decoration-none">
                <div class="card h-100 text-center dashboard-card-link">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center">
                        <i class="fa-solid fa-file-invoice fa-3x mb-3 text-secondary"></i>
                        <h5 class="card-title">Export Orders</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <a href="#" class="text-decoration-none post-action" data-action="@Url.Action("ImportDynamicArtists", "Admin")">
                <div class="card h-100 text-center dashboard-card-link">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center">
                        <i class="fa-solid fa-users fa-3x mb-3 text-success"></i>
                        <h5 class="card-title">Import Artists</h5>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-lg-3 col-md-6 mb-4">
            <a href="#" class="text-decoration-none post-action" data-action="@Url.Action("ImportTen", "Admin")">
                <div class="card h-100 text-center dashboard-card-link">
                    <div class="card-body d-flex flex-column justify-content-center align-items-center">
                        <i class="fa-solid fa-file-import fa-3x mb-3 text-success"></i>
                        <h5 class="card-title">Import Countries</h5>
                    </div>
                </div>
            </a>
        </div>
    </div>
</div>

<div class="modal fade" id="usersModal" tabindex="-1" aria-labelledby="usersModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="usersModalLabel"><i class="fas fa-users me-2"></i>All Registered Users (@Model.TotalUsers)</h5>
                <button type="button" class="btn-close interactive-btn" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body modal-scrollable-content">
                <div class="list-group list-group-flush">
                    @foreach (var user in Model.AllUsers.OrderBy(u => u.FirstName))
                    {
                        <div class="list-group-item d-flex align-items-center">
                            <i class="fas fa-user-circle fa-2x text-muted me-3"></i>
                            <div class="flex-grow-1">
                                <div class="fw-bold">@user.FirstName @user.LastName</div>
                                <div class="text-muted small">@user.Email</div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="ordersModal" tabindex="-1" aria-labelledby="ordersModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ordersModalLabel"><i class="fas fa-shopping-cart me-2"></i>All Orders (@Model.TotalOrders)</h5>
                <button type="button" class="btn-close interactive-btn" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body modal-scrollable-content">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Total Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model.AllOrders.OrderByDescending(o => o.Id))
                        {
                            <tr>
                                <td><small>@order.Id</small></td>
                                <td>@order.Owner?.Email</td>
                                <td>@String.Format("{0:C}", order.RecordsInOrder.Sum(i => i.Quantity * i.Record.Price))</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="recordsModal" tabindex="-1" aria-labelledby="recordsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="recordsModalLabel"><i class="fas fa-compact-disc me-2"></i>All Records in Store (@Model.TotalRecords)</h5>
                <button type="button" class="btn-close interactive-btn" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body modal-scrollable-content">
                <table class="table table-hover align-middle">
                    <thead class="table-light"><tr><th style="width: 70px;">Cover</th><th>Title</th><th>Artist</th><th class="text-center">Stock</th></tr></thead>
                    <tbody>
                        @foreach (var record in Model.AllRecords.OrderBy(r => r.Title))
                        {
                            <tr>
                                <td><img src="@record.CoverURL" alt="@record.Title" style="width: 50px; height: 50px; object-fit: cover;" class="rounded" /></td>
                                <td class="fw-bold">@record.Title</td>
                                <td>@record.Artist?.Name</td>
                                <td class="text-center">@record.StockQuantity</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="reviewsModal" tabindex="-1" aria-labelledby="reviewsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reviewsModalLabel"><i class="fas fa-comments me-2"></i>All Reviews (@Model.TotalReviews)</h5>
                <button type="button" class="btn-close interactive-btn" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body modal-scrollable-content bg-light p-4">
                @if (Model.AllReviews.Any())
                {
                    @foreach (var review in Model.AllReviews.OrderByDescending(r => r.DateCreated))
                    {
                        <div class="card mb-3 shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="card-subtitle text-muted">For: <strong>@review.Record?.Title</strong></h6>
                                    <div class="rating-stars-modal">
                                        @for (int i = 0; i < review.Rating; i++)
                                        {
                                            @:★
                                        }
                                        @for (int i = review.Rating; i < 5; i++)
                                        {
                                            @:☆
                                        }
                                    </div>
                                </div>

                                @if (!string.IsNullOrEmpty(review.Comment))
                                {
                                    <p class="card-text fst-italic">"@review.Comment"</p>
                                }
                                else
                                {
                                    <p class="card-text text-muted fst-italic">(No comment provided)</p>
                                }

                                <footer class="text-end text-muted small mt-2">
                                    &mdash; @review.User?.UserName on @review.DateCreated.ToShortDateString()
                                </footer>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="text-center p-5">
                        <p class="lead">No reviews have been submitted yet.</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<form id="adminPostForm" method="post" class="d-none">
    @Html.AntiForgeryToken()
</form>

@section Scripts {
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            const postActionLinks = document.querySelectorAll('.post-action');
            const adminForm = document.getElementById('adminPostForm');
            if (adminForm) {
                postActionLinks.forEach(link => {
                    link.addEventListener('click', function (event) {
                        event.preventDefault();
                        const actionUrl = this.getAttribute('data-action');
                        adminForm.setAttribute('action', actionUrl);
                        adminForm.submit();
                    });
                });
            }
        });
    </script>
}